adaptive_resnet_controller:
  ros__parameters:
    # Neural Network Architecture
    resnet:
      num_blocks: 2
      num_layers: 3
      num_neurons: 20
      input_size: 15  # pos(3) + vel(3) + ref_vel(3) + error(3) + angles(3)
      output_size: 3  # velocity corrections [vx, vy, vz]
      inner_activation: "tanh"
      output_activation: "identity"
      shortcut_activation: "identity"

    # Learning Parameters
    learning:
      initial_rate: 0.001
      min_singular_value: 0.1
      max_singular_value: 10.0
      weight_bounds: 2.0
      decay_rate: 0.999

    # Control Parameters
    control:
      rate_hz: 100.0  # Match your odometry rate
      # Safer starting caps for residual corrections
      max_velocity_correction: 0.2      # m/s - XY correction cap
      max_velocity_correction_z: 0.05   # m/s - Z correction cap (tighter)
      baseline_gain: 1.0                # Gain for baseline controller enhancement
      mix_source: "baseline"            # 'reference' or 'baseline'
      # Residual shaping (tune with training OFF first)
      residual_gain: 0.10               # Overall residual scale (start small)
      residual_smoothing_alpha: 0.05    # 0..1, lower = less lag
      output_ramp_steps: 75             # Faster ramp-in for responsiveness

    # Training Control
    training:
      enabled_on_start: false       # Tune residual with training OFF first
      warmup_steps: 500             # ~5s warmup at 100 Hz
      min_error_threshold: 0.01     # No training when already very close
      max_error_threshold: 3.0      # Allow training on larger steps while testing
      learning_decay_rate: 0.999    # Learning rate decay factor

    # Safety Parameters
    safety:
      max_output_magnitude: 0.30  # Clamp overall residual magnitude
      emergency_stop_error: 6.0   # Slightly higher to avoid premature stops during tests

    # Diagnostics
    diagnostics:
      publish_rate_hz: 10.0
      log_interval_steps: 100
